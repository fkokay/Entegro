@{
    ViewData["Title"] = "Erp Entegrasyonları";
    var myErpList = ViewBag.MyErp as IEnumerable<IntegrationSystemViewModel>;
    var logoUrls = new Dictionary<string, string>
    {
        { "Logo", "https://www.logo.com.tr/_next/image?url=%2Flogo.webp&w=1920&q=75" },
        { "Netsis", "https://bworks.tc/images/Bilgi-Islem/Netsis/netsis_hakkinda/netsis.gif" },
        { "Opak", "https://www.opakyazilim.com/Content/images/common/logoOpak.svg" }
    };
}

<div class="flex-grow-1 container-p-y container-fluid">
    <h4 class="fw-bold py-3 mb-4"><span class="text-muted fw-light"></span> Erp Entegrasyonu Ekle</h4>
    <div class="row">
        <div class="col-4">
            <div class="card mb-3">
                <div class="row g-0">
                    <div class="col-md-4 d-flex align-items-center justify-content-center">
                        <img class="card-img card-img-left w-75" src="https://www.logo.com.tr/_next/image?url=%2Flogo.webp&w=1920&q=75" alt="Card image">
                    </div>
                    <div class="col-md-8">
                        <div class="card-body">
                            <h5 class="card-title">Logo</h5>
                            <p class="card-text">
                                Logo yazılım ürünleri ile entegre çalışabilmektedir.
                            </p>
                        </div>
                    </div>
                </div>
                <div class="row p-3">
                    <div class="mb-0">
                        <button type="button" onclick="SelectErp('Logo')" class="btn btn-success waves-effect waves-light w-100">
                            <i class="ti ti-plus me-1"></i>
                            <span class="align-middle"> Entegrasyon Ekle</span>
                        </button>
                    </div>
                </div>
            </div>

        </div>



        <div class="col-4">
            <div class="card mb-3">
                <div class="row g-0">
                    <div class="col-md-4 d-flex align-items-center justify-content-center">
                        <img class="card-img card-img-left w-75" src="https://bworks.tc/images/Bilgi-Islem/Netsis/netsis_hakkinda/netsis.gif" alt="Card image">
                    </div>
                    <div class="col-md-8">
                        <div class="card-body">
                            <h5 class="card-title">Netsis</h5>
                            <p class="card-text">
                                Netis yazılım ürünleri ile entegre çalışabilmektedir.
                            </p>
                        </div>
                    </div>
                </div>
                <div class="row p-3">
                    <div class="mb-0">
                        <button type="button" onclick="SelectErp('Netsis')" class="btn btn-success waves-effect waves-light w-100">
                            <i class="ti ti-plus me-1"></i>
                            <span class="align-middle"> Entegrasyon Ekle</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-4">
            <div class="card mb-3">
                <div class="row g-0">
                    <div class="col-md-4 d-flex align-items-center justify-content-center">
                        <img class="card-img card-img-left w-75" src="https://www.opakyazilim.com/Content/images/common/logoOpak.svg" alt="Card image">
                    </div>
                    <div class="col-md-8">
                        <div class="card-body">
                            <h5 class="card-title">Opak</h5>
                            <p class="card-text">
                                Opak yazılım ürünleri ile entegre çalışabilmektedir.
                            </p>
                        </div>
                    </div>
                </div>
                <div class="row p-3">
                    <div class="mb-0">
                        <button type="button" onclick="SelectErp('Opak')" class="btn btn-success waves-effect waves-light w-100">
                            <i class="ti ti-plus me-1"></i>
                            <span class="align-middle">Entegrasyon Ekle</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>



    @if (myErpList != null)
    {


        <h4 class="fw-bold py-3 mb-4"><span class="text-muted fw-light"></span> Erp Entegrasyonlarım</h4>
        <div class="row">
            @foreach (var erp in myErpList)
            {
                var value = erp.IntegrationSystemParameter.Value;

                if (!logoUrls.ContainsKey(value))
                {
                    continue;
                }

                var logoUrl = logoUrls[value];

                <div class="col-4">

                    <div class="card mb-3">
                        <div class="row g-0">
                            <div class="col-md-4 d-flex align-items-center justify-content-center">
                                <img class="card-img card-img-left w-75" src="@logoUrl" alt="Card image">
                            </div>
                            <div class="col-md-8">
                                <div class="card-body">
                                    <h5 class="card-title">@erp.Name</h5>
                                    <p class="card-text">
                                        @erp.Description
                                    </p>
                                </div>
                            </div>
                        </div>
                        <div class="row p-3">
                            <div class="mb-0 d-flex">
                                <a type="button" asp-action="ErpSettings" asp-asp-controller="Settings" asp-route-integrationSystemErpId="@erp.Id" target="_blank" class="btn btn-success waves-effect waves-light w-50">
                                    <i class="ti ti-settings me-1"></i>
                                    <span class="align-middle">Ayarla</span>
                                </a>
                                <a href="javascript:void(0);" type="button" onclick="iptalEt(@erp.Id)" class="btn btn-danger waves-effect waves-light w-50 ms-2">
                                    <i class="ti ti-eraser me-1"></i>
                                    <span class="align-middle">Sil</span>
                                </a>

                            </div>

                        </div>
                    </div>
                </div>
            }
        </div>
    }
</div>


<div class="modal fade" id="addErp" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-simple modal-edit-user modal-dialog-centered">
        <div class="modal-content p-3 p-md-5">
            <div class="modal-body">
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                <div class="text-center mb-4">
                    <h3 class="mb-2">Entegrasyon Ekle</h3>
                </div>
                <form id="addErpForm" class="row g-3" onsubmit="return false">
                    <input type="hidden" id="IntegrationSystemType" name="IntegrationSystemType" />
                    <div class="col-12 col-md-12">
                        <label class="form-label" for="ModalName">Adı</label>
                        <input type="text"
                               id="ModalName"
                               name="ModalName"
                               class="form-control"
                               placeholder="Adı" required />
                    </div>
                    <div class="col-12 col-md-12">
                        <label class="form-label" for="ModalDescription">Açıklaması</label>
                        <textarea type="text"
                                  id="ModalDescription"
                                  name="ModalDescription"
                                  class="form-control" rows="3"></textarea>
                    </div>



                    <div class="col-12 text-center">
                        <button type="submit" class="btn btn-primary me-sm-3 me-1">Kaydet</button>
                        <button type="reset"
                                class="btn btn-label-secondary"
                                data-bs-dismiss="modal"
                                aria-label="Close">
                            Kapat
                        </button>
                    </div>
                </form>

            </div>
        </div>
    </div>
</div>

@section Scripts {


    <script>
        function SelectErp(integrationSystemType) {
            $('#IntegrationSystemType').val(integrationSystemType);
            bootstrap.Modal.getOrCreateInstance(document.getElementById('addErp')).show();
        }

        $(function () {
            $('#addErpForm').on('submit', function (e) {
                e.preventDefault();

                $.ajax({
                    url: '@Url.Action("Erp", "Settings")',
                    type: 'POST',
                    data: $(this).serialize(),
                    success: function (res) {
                        if (res.success) {
                            location.reload();
                        }
                    },
                    error: function () {
                        alert("Hata oluştu");
                    }
                });
            });
        });

    </script>


    <script>
        function iptalEt(integrationSystemId) {
            Swal.fire({
                title: 'Emin misiniz?',
                text: "Bu mağazayı silmek üzeresiniz!",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#d33',
                cancelButtonColor: '#3085d6',
                confirmButtonText: 'Evet',
                cancelButtonText: 'Vazgeç'
            }).then((result) => {
                if (result.isConfirmed) {
                    fetch('/settings/ErpDelete', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(integrationSystemId)
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            Swal.fire({
                                title: 'İptal Edildi!',
                                text: 'Bu mağaza başarıyla silindi.',
                                icon: 'success',
                                timer: 1500,
                                showConfirmButton: false
                            }).then(() => {
                                window.location.href = '/settings/erp';
                            });
                        } else {
                            Swal.fire('Hata!', data.message || 'Bir hata oluştu.', 'error');
                        }
                    })
                    .catch(() => Swal.fire('Hata!', 'Sunucuya bağlanırken hata oluştu.', 'error'));
                }
            });
        }
    </script>


}
