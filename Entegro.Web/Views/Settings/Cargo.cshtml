@{
    ViewData["Title"] = "Kargo Entegrasyonları";
    var myCargoList = ViewBag.MyCargo as IEnumerable<IntegrationSystemViewModel>;
    var logoUrls = new Dictionary<string, string>
    {
        { "Yurtici", "https://www.yurticikargo.com/web_files/yurtici-kargo/assets/img/logo.svg" },
        { "PTT", "https://www.ptt.gov.tr/_next/image?url=%2F_next%2Fstatic%2Fmedia%2F184logo.0437c82e.png&w=256&q=75" },
        { "Aras", "https://www.araskargo.com.tr/assets/images/aras-logo.svg" }
    };
}

<div class="flex-grow-1 container-p-y container-fluid">
    <h4 class="fw-bold py-3 mb-4"><span class="text-muted fw-light"></span> Kargo Entegrasyonu Ekle</h4>
    <div class="row">
        <div class="col-4">
            <div class="card mb-3">
                <div class="row g-0">
                    <div class="col-md-4 d-flex align-items-center justify-content-center">
                        <img class="card-img card-img-left w-75" src="https://www.yurticikargo.com/web_files/yurtici-kargo/assets/img/logo.svg" alt="Card image">
                    </div>
                    <div class="col-md-8">
                        <div class="card-body">
                            <h5 class="card-title">Yurtiçi Kargo</h5>
                            <p class="card-text">
                                Yurtiçi Kargo ile entegre çalışabilmektedir.
                            </p>
                        </div>
                    </div>
                </div>
                <div class="row p-3">
                    <div class="mb-0">
                        <button type="button" class="btn btn-success w-100" onclick="SelectCargo('Yurtici')">
                            Mağaza Ekle
                        </button>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-4">
            <div class="card mb-3">
                <div class="row g-0">
                    <div class="col-md-4 d-flex align-items-center justify-content-center">
                        <img class="card-img card-img-left w-75" src="https://www.ptt.gov.tr/_next/image?url=%2F_next%2Fstatic%2Fmedia%2F184logo.0437c82e.png&w=256&q=75" alt="Card image">
                    </div>
                    <div class="col-md-8">
                        <div class="card-body">
                            <h5 class="card-title">PTT Kargo</h5>
                            <p class="card-text">
                                PTT Kargo ile entegre çalışabilmektedir.
                            </p>
                        </div>
                    </div>
                </div>
                <div class="row p-3">
                    <div class="mb-0">
                        <button type="button" class="btn btn-success w-100" onclick="SelectCargo('PTT')">
                            Mağaza Ekle
                        </button>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-4">
            <div class="card mb-3">
                <div class="row g-0">
                    <div class="col-md-4 d-flex align-items-center justify-content-center">
                        <img class="card-img card-img-left w-75" src="https://www.araskargo.com.tr/assets/images/aras-logo.svg" alt="Card image">
                    </div>
                    <div class="col-md-8">
                        <div class="card-body">
                            <h5 class="card-title">Aras Kargo</h5>
                            <p class="card-text">
                                Aras Kargo ile entegre çalışabilmektedir.
                            </p>
                        </div>
                    </div>
                </div>
                <div class="row p-3">
                    <div class="mb-0">
                        <button type="button" class="btn btn-success w-100" onclick="SelectCargo('Aras')">
                            Mağaza Ekle
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    @if (myCargoList != null)
    {

        <h4 class="fw-bold py-3 mb-4"><span class="text-muted fw-light"></span> Kargo Entegrasyonlarım</h4>
        <div class="row">
            @foreach (var cargo in myCargoList)
            {
                var value = cargo.IntegrationSystemParameter.Value;

                if (!logoUrls.ContainsKey(value))
                {
                    continue;
                }

                var logoUrl = logoUrls[value];
                <div class="col-4">
                    <div class="card mb-3">
                        <div class="row g-0">
                            <div class="col-md-4 d-flex align-items-center justify-content-center">
                                <img class="card-img card-img-left w-75" src="@logoUrl" alt="Card image">
                            </div>
                            <div class="col-md-8">
                                <div class="card-body">
                                    <h5 class="card-title">@cargo.Name</h5>
                                    <p class="card-text">@cargo.Description</p>
                                </div>
                            </div>
                        </div>
                        <div class="row p-3">
                            <div class="mb-0 d-flex">
                                <a type="button"
                                   asp-action="CargoSettings"
                                   asp-controller="Settings"
                                   asp-route-integrationSystemCargoId="@cargo.Id"
                                   target="_blank"
                                   class="btn btn-success waves-effect waves-light w-50">
                                    <i class="ti ti-settings me-1"></i>
                                    <span class="align-middle">Ayarla</span>
                                </a>
                                <a href="javascript:void(0);"
                                   type="button"
                                   onclick="iptalEt(@cargo.Id)"
                                   class="btn btn-danger waves-effect waves-light w-50 ms-2">
                                    <i class="ti ti-eraser me-1"></i>
                                    <span class="align-middle">Sil</span>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            }
        </div>
    }
</div>


<div class="modal fade" id="addCargo" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-simple modal-edit-user modal-dialog-centered">
        <div class="modal-content p-3 p-md-5">
            <div class="modal-body">
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                <div class="text-center mb-4">
                    <h3 class="mb-2">Mağaza Ekle</h3>
                </div>
                <form id="addCargoForm" class="row g-3" onsubmit="return false">
                    <input type="hidden" id="IntegrationSystemType" name="IntegrationSystemType" />
                    <div class="col-12 col-md-12">
                        <label class="form-label" for="ModalName">Mağaza Adı</label>
                        <input type="text"
                               id="ModalName"
                               name="ModalName"
                               class="form-control"
                               placeholder="Mağaza Adı" required />
                    </div>
                    <div class="col-12 col-md-12">
                        <label class="form-label" for="ModalDescription">Mağaza Açıklaması</label>
                        <textarea type="text"
                                  id="ModalDescription"
                                  name="ModalDescription"
                                  class="form-control" rows="3"></textarea>
                    </div>



                    <div class="col-12 text-center">
                        <button type="submit" class="btn btn-primary me-sm-3 me-1">Kaydet</button>
                        <button type="reset"
                                class="btn btn-label-secondary"
                                data-bs-dismiss="modal"
                                aria-label="Close">
                            Kapat
                        </button>
                    </div>
                </form>

            </div>
        </div>
    </div>
</div>

@section Scripts {



    <script>
        function SelectCargo(integrationSystemType) {
            $('#IntegrationSystemType').val(integrationSystemType);
            bootstrap.Modal.getOrCreateInstance(document.getElementById('addCargo')).show();
        }

        $(function () {
            $('#addCargoForm').on('submit', function (e) {
                e.preventDefault();

                $.ajax({
                    url: '@Url.Action("Cargo", "Settings")',
                    type: 'POST',
                    data: $(this).serialize(),
                    success: function (res) {
                        if (res.success) {
                            location.reload();
                        }
                    },
                    error: function () {
                        alert("Hata oluştu");
                    }
                });
            });
        });

    </script>


    <script>
        function iptalEt(integrationSystemId) {
            Swal.fire({
                title: 'Emin misiniz?',
                text: "Bu entegrasyonu silmek üzeresiniz!",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#d33',
                cancelButtonColor: '#3085d6',
                confirmButtonText: 'Evet',
                cancelButtonText: 'Vazgeç'
            }).then((result) => {
                if (result.isConfirmed) {
                    fetch('/settings/CargoDelete', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(integrationSystemId)
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            Swal.fire({
                                title: 'İptal Edildi!',
                                text: 'Entegrasyon başarıyla silindi.',
                                icon: 'success',
                                timer: 1500,
                                showConfirmButton: false
                            }).then(() => {
                                window.location.href = '/settings/cargo';
                            });
                        } else {
                            Swal.fire('Hata!', data.message || 'Bir hata oluştu.', 'error');
                        }
                    })
                    .catch(() => Swal.fire('Hata!', 'Sunucuya bağlanırken hata oluştu.', 'error'));
                }
            });
        }
    </script>


}