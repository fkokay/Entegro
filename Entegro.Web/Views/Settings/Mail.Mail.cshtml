@model MailSettingsViewModel
@{
    ViewData["Title"] = "Mail Entegrasyonu Ayarları";
}

<form asp-action="MailParameter" id="mail-setting-form">
    @Html.HiddenFor(m => m.IntegrationSystemId)
    @Html.HiddenFor(m => m.MailType)
    <div class="flex-grow-1 container-p-y container-fluid">
        <div class="d-flex flex-column justify-content-center">
            <h4 class="mb-3">@ViewData["Title"]</h4>
        </div>
        <div class="row">
            <div class="col-lg-9 col-12 mb-lg-0 mb-4">
                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">Mail Entegrasyon Ayarları</h5>
                    </div>
                    <div class="card-body">
                        <div class="mb-6">
                            <label class="form-label" for="email">E-Posta Adresi</label>
                            @Html.TextBoxFor(m => m.Email, new { @class = "form-control", required = "required", id = "email" })
                        </div>
                        <div class="mb-6">
                            <label class="form-label" for="emailDisplayName">E-mail görüntüleme adı</label>
                            @Html.TextBoxFor(m => m.EmailDisplayName, new { @class = "form-control", required = "required", id = "emailDisplayName" })
                        </div>
                        <div class="mb-6">
                            <label class="form-label" for="host">Host</label>
                            @Html.TextBoxFor(m => m.Host, new { @class = "form-control", required = "required", id = "host" })
                        </div>
                        <div class="mb-6">
                            <label class="form-label" for="port">Port</label>
                            @Html.TextBoxFor(m => m.Port, new { @class = "form-control", type = "number", min = "0", id = "port" })
                        </div>
                        <div class="mb-6">
                            <label class="form-label" for="username">Kullanıcı</label>
                            @Html.TextBoxFor(m => m.Username, new { @class = "form-control", id = "username" })
                        </div>
                        <div class="mb-6">
                            <label class="form-label" for="password">Parola</label>
                            @Html.TextBoxFor(m => m.Password, new { @class = "form-control", id = "password" })
                        </div>
                        <div class="mb-6">
                            <label class="form-label" for="encryption">Şifreleme</label>
                            @Html.DropDownListFor(m => m.EncryptionType, new SelectList(new[]
                            {
                                new { Value = "", Text = "Şifreleme yok" },
                                                        new { Value = "Auto", Text = "Otomatik (varsa SSL veya TLS, aksi takdirde şifreleme yapmayın)" },
                                                        new { Value = "Immediate", Text = "Immediately (SSL veya TLS ile bağlantıyı hemen şifreleyin)" }
                                                        }, "Value", "Text"), new { @class = "form-control", id = "encryption" })
                        </div>
                    </div>

                </div>
            </div>
            <div class="col-lg-3 col-12 mail-setting-actions">
                <div class="card mb-4">
                    <div class="card-body">
                        <button type="submit" class="btn btn-primary d-grid w-100 mb-2 waves-effect waves-light">
                            <span class="d-flex align-items-center justify-content-center text-nowrap"><i class="ti ti-check ti-xs me-1"></i>Kaydet</span>
                        </button>
                        <a href="javascript:void(0);" onclick="iptalEt(@Model.IntegrationSystemId)" class="btn btn-label-secondary d-grid w-100 waves-effect">İptal Et</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</form>

<script>
    function iptalEt(integrationSystemId) {
        Swal.fire({
            title: 'Emin misiniz?',
            text: "Bu entegrasyonu iptal etmek üzeresiniz!",
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#d33',
            cancelButtonColor: '#3085d6',
            confirmButtonText: 'Evet',
            cancelButtonText: 'Vazgeç'
        }).then((result) => {
            if (result.isConfirmed) {
                fetch('/settings/maildelete', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(integrationSystemId)
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        Swal.fire({
                            title: 'İptal Edildi!',
                            text: 'Bu entegrasyon başarıyla iptal edildi.',
                            icon: 'success',
                            timer: 1500,
                            showConfirmButton: false
                        }).then(() => {
                            window.location.href = '/settings/maildelete';
                        });
                    } else {
                        Swal.fire('Hata!', data.message || 'Bir hata oluştu.', 'error');
                    }
                })
                .catch(() => Swal.fire('Hata!', 'Sunucuya bağlanırken hata oluştu.', 'error'));
            }
        });
    }
</script>


